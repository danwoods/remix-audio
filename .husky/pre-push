echo "ğŸ§ª Running tests before push..."

# Run documentation tests
echo "Running documentation tests..."
deno task test:doc

if [ $? -ne 0 ]; then
  echo "âŒ Documentation tests failed. Push aborted."
  exit 1
fi

# Run Deno tests
echo "Running Deno tests..."
deno test deno-tests/ --no-check --allow-net --allow-env --allow-read --allow-write --allow-sys

if [ $? -ne 0 ]; then
  echo "âŒ Deno tests failed. Push aborted."
  exit 1
fi

# Run Node/Vitest tests (exclude Deno tests and Deno-dependent tests)
echo "Running Node/Vitest tests..."
npm test -- --exclude="deno-tests/**" --exclude="server/**" --exclude="app/util/s3.server.test.ts"

if [ $? -ne 0 ]; then
  echo "âŒ Node tests failed. Push aborted."
  exit 1
fi

echo "âœ… All tests passed!"
